
### Function Call Obfuscation

Function call obfuscation is a method of hiding your DLLs and external functions that will be called during runtime.  

Every PE module (exe, dll, etc) usually uses external functions. When it is running it call functions in an external DLL which are mapped into process memory in order to make them available to the process.  

One of the ways AV detects malicious PE files is by analysing which external DLLs and functions are used by the binary. This is done without ever actually running the binary.  

It analyses the PE file on disk by looking into its import address table and compares the functions the binary wants to call at runtime against a known list of suspicious functions. This method leads to false-positives however is widely used. It is however not bulletproof.  

What can we do about it?  

We can use standard windows API functions called GetModuleHandle and GetProcAddress.  
`GetModuleHandle` returns a handle to a specified DLL  
`GetProcAddress` allows you to obtain the memory address of the function you need which is exported from the DLL  

We will need to xor the string that contains the name of the functon we want to call still as this will be present in the binary - best key to use is an existing string retrived from binary, this lessens the chance of detection.  

This hides the function during static analysis, this is because at compilation time, the compiler will not include the dll in the import address table.  

